<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <!-- If for some reason you are using IE, use edge -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!-- So bootstrap isn't horrible, set the width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="theme-color" content="#ffffff">

  <title>CS 341 · Pugnacious Profiles</title>

  <!-- Reference a CDN so this is properly cached in the browser forever. Unless they clean out the
       Cache this will incur no load time. Ideally we should put a security checksum but that breaks
       Firefox development sometimes -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" crossorigin="anonymous">
  <!-- For table of content  -->

  <link rel="stylesheet" href="/css/code-style.css"/>
  <link rel="stylesheet" href="/css/main.css"/>
  <link rel="stylesheet" href="/css/bootstrap-toc.css"/>

  <meta property="og:locale" content="en_US">

  
  <meta property="og:title" content="Pugnacious Profiles" />
  

  <meta property="og:type" content="article" />
  <meta property="og:url" content="http://cs341.cs.illinois.edu" />

  
  <meta property="og:description" content=""Webpage for CS 341: System Programming at the University of Illinois Urbana-Champaign. All documentation and information about the course can be found here."
" />
  

</head>


<body data-spy="scroll" data-target="#overview" data-offset="50">
  <div class="container-fluid">
    <div class="row" style="display: flex; justify-content: stretch;">
      <!-- Always shows a header, even in smaller screens. -->
<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <!-- Navigation button as html so we don't have to resize images -->
      <button
        type="button"
        class="navbar-toggle collapsed"
        data-toggle="collapse"
        data-target=".navbar-collapse"
        aria-expanded="false"
        aria-controls="navbar"
      >
        <!-- Hamburger Navigation bar on small -->
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <!-- Full title on laptop -->
      <a class="navbar-brand navbar-item normal" href="/">
             <span>CS 341: System Programming</span> 
      </a>

      <!-- Smaller on mobile-->
      <a class="navbar-brand navbar-item small" href="/">
          <span>CS 341</span>
      </a>
    </div>

    <!-- Finally generate what is in the navbar -->
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
        <li class="navbar-item">
          <a href="/assignments.html">Assignments</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
          </ul>
        </li>
        
        <li class="navbar-item">
          <a href="/quiz_topics.html">Quizzes</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
          </ul>
        </li>
        
        <li class="navbar-item">
          <a href="/grades.html">Grades</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
          </ul>
        </li>
        
        <li class="navbar-item">
          <a href="/schedule.html">Lectures</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
          </ul>
        </li>
        
        <li class="navbar-item">
          <a href="/syllabus.html">Syllabus</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
          </ul>
        </li>
        
        <li class="navbar-item">
          <a href="/staff.html">Staff</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
          </ul>
        </li>
        
        <li class="navbar-item">
          <a href="/resources.html">Resources</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
            <li class="navbar-subitem">
              <a href="/peer_tutoring.html">Peer Tutoring</a>
            </li>
            
            <li class="navbar-subitem">
              <a href="/coursebook/index.html">Coursebook</a>
            </li>
            
            <li class="navbar-subitem">
              <a href="">Lecture Materials</a>
            </li>
            
            <li class="navbar-subitem">
              <a href="/tutorials/development">Linux Virtual Machine</a>
            </li>
            
          </ul>
        </li>
        
        <li class="navbar-item">
          <a href="/honors.html">Honors</a>
          <!-- Generate sublinks-->
          <ul class="nav navbar-nav subitem-container">
            
          </ul>
        </li>
        
      </ul>
    </div>
  </div>
  <!-- Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Roboto"
    rel="stylesheet"
  />
</nav>

      <div class="row">
        <div class="col-sm-3 col-xs-12 hidden-xs" style="min-height: 100%">
          <nav id="overview" data-toggle="toc" class="sticky-top"></nav>
        </div>
        <div class="col-sm-9 col-xs-12">
          <div class="title">
            
            
            
            <h1>
              Pugnacious Profiles
            </h1>
          </div>
          <div class="content col-sm-11 .col-sm-offset-1">
            
            <div class="submission-wrapper">
              
              <b>Entire Assignment</b> due <b>2019-10-22 23:59</b><br />
              
              <b>Graded files:</b>
              <ul>
                
                <li>orderbook.c</li>
                
                <li>orderbook.h</li>
                
              </ul>
              
              
            </div>
            
          </div>
          <div class="hidden-sm hidden-md hidden-lg">
            
            <div class="toc-wrapper">
<h4>Content</h4>
<ul class="toc">
<li><a id="toc_high-frequency-trading" href="#high-frequency-trading" class="fancy-link">High Frequency Trading</a></li>
<li><a id="toc_input--output" href="#input--output" class="fancy-link">Input / Output</a></li>
<li><a id="toc_part---1" href="#part---1" class="fancy-link">Part - 1</a></li>
<li><a id="toc_part---2-optional" href="#part---2-optional" class="fancy-link">Part - 2 (Optional)</a></li>
<li><a id="toc_challenge-not-graded" href="#challenge-not-graded" class="fancy-link">Challenge (Not Graded)</a></li>
</ul>
</div>
            
          </div>
          <div id="content">
            
  <h2 id="learning-objectives">Learning Objectives</h2>
  <p>
    The learning objectives for Pugnacious Profiles are: <br/>
    <ul class="mdl-list">
      
        <li class="mdl-list__item">
          <span class="mdl-list__item-primary-content">Understanding profiling</span>
        </li>
      
        <li class="mdl-list__item">
          <span class="mdl-list__item-primary-content">Performance optimization (both time and memory)</span>
        </li>
      
        <li class="mdl-list__item">
          <span class="mdl-list__item-primary-content">Applying data structures in systems</span>
        </li>
      
    </ul>
  </p>



            <div class="wrapper">
<p>Over the course of this assignment, we will be exploring how profilers can be used to optimize your C program through 
the combination of dynamic analysis, data-structures and algorithms along with systems programming.</p>

<p><em>Note: We recommend using the EWS systems instead of the VM as there would be further discrepancies of metrics and 
compatibility between both.</em></p>

<div class="pad"><div class="card">
<div class="title"><h2 id="high-frequency-trading" class="title-text">High Frequency Trading<a class="anchor title-text" href="#high-frequency-trading"> #</a>
</h2></div>




<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>In high-frequency trading (HFT), programs analyze market data to find and take advantage of trading opportunities that 
often only exist for a few seconds. Messages describing trade offers can reach rates of up to 250,000 messages/second.
Thus, programs involved in automated trading have to process a lot of data extremely quickly.</p>
<p>The program provided to you will read in and process a stream of order messages for multiple stocks. These messages will 
be used to update our program’s view of the market state. This state is known as the “order book”. The messages we 
process will either trigger the entry of a new order, change an existing order, or delete an order. 
At the end of the stream, this program will print out all the current orders in the order book.</p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="input--output" class="title-text">Input / Output<a class="anchor title-text" href="#input--output"> #</a>
</h2></div>
















<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>The program will check the command line arguments for a <em>-i</em> input filename flag. If it is present, the program will read 
the input stream from the file named there. If it is not, the program will read the input from standard input. 
Likewise, it will check the command line arguments for a <em>-o</em> output filename flag. If it is present, the program will 
write the output stream to the file named there. If it is not, the program will write the output to standard output.</p>
<p><strong>Stream Format</strong></p>
<p>The program will read in input as ASCII text, of which the format is as follows:</p>
<ul>
  <li>
    <p>A &lt;id&gt; &lt;side&gt; &lt;symbol&gt; &lt;quantity&gt; &lt;price&gt; - A new order is added with the supplied details.
Side is either B for buy or S for sell</p>
  </li>
  <li>
    <p>X &lt;id&gt; &lt;symbol&gt; - An order is cancelled</p>
  </li>
  <li>
    <p>T &lt;id&gt; &lt;symbol&gt; &lt;quantity&gt; - An order is (partially) executed for the given quantity (remove this
quantity from the existing order in your records)</p>
  </li>
  <li>
    <p>C &lt;id&gt; &lt;symbol&gt; &lt;quantity&gt; - An order is (partially) cancelled for the given quantity (remove this
quantity from the existing order in your records)</p>
  </li>
  <li>
    <p>R &lt;id&gt; &lt;symbol&gt; &lt;quantity&gt; &lt;price&gt; - An order is changed to have the given price and quantity</p>
  </li>
</ul>
<p>Example input:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A 344532111 S SPY 300 117.880000
R 344532111 SPY 300 117.840000
T 344532111 SPY 100
C 344532111 SPY 100
A 344533172 B SPY 200 117.110000
A 344533348 B SPY 280 118.050000
X 344533348 SPY
</code></pre></div></div>
<p>This would be a new order to sell 300 shares of the stock SPY at $117.88. It is followed by a message to change the 
previous order to sell at a price of $117.84. The next two messages indicate that the order is partially executed and 
cancelled by 100 respectively. The next message is a new order to buy 200 shares of the stock SPY at $117.11. The last
two messages add a buy order and then cancel it. If this was the entire message stream, your program would print out the 
following output.</p>
<p>Example output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>344533172 B 200 117.110000
344532111 S 100 117.840000
</code></pre></div></div>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="part---1" class="title-text">Part - 1<a class="anchor title-text" href="#part---1"> #</a>
</h2></div>































<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>High frequency trading requires optimal performance demanding high speed and for this part of the project we are going
to meet those goals. While the program provided to you does everything correctly, it is too slow to scale up and process 
real-time orders. On the other hand your competitors solution (TA reference implementation) is way faster than this. <br>
Your job is to analyze the performance of this program and bring it within a certain threshold thus defeating your 
competitor.</p>
<p><strong>Time</strong></p>
<p>To measure time, use the /usr/bin/time command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ time ./orderbook -i input/ascii_data.txt -o ob.txt
</code></pre></div></div>
<p>On the EWS systems in Siebel, the implementation provided to you will roughly run around the following time output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>real    0m8.281s
user    0m8.022s
sys     0m0.042s
</code></pre></div></div>
<p><em>Note: While this may be higher or lower based on the computational resources available, it will never get close to the
expected performance threshold.</em></p>
<p>What do each of these values mean and which one is relevant for us? 
<a href="https://stackoverflow.com/questions/556405/what-do-real-user-and-sys-mean-in-the-output-of-time1/556411" class="fancy-link wiki-link">Explanation</a> <br></p>
<p><strong>Task</strong></p>
<p>Your job is to defeat our reference implementation (your competitors) which has a user time of <strong>2.000 seconds</strong> and 
a system time of <strong>0.020 seconds</strong> for the data-set of ascii_data.txt provided to you. Your program when executed with 
<strong><em>-h</em></strong> flag needs to be below this threshold maintaining the correctness in order to complete part 1.</p>
<p><strong>Profile Time</strong></p>
<p>While the time command does provide us with an overall performance of our program, it doesn’t help pin point where the 
issue is. Gprof will come to our rescue. To utilize gprof, use the following commands:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ make orderbook_profile
$ ./orderbook_gprof -i input/ascii_data.txt -o ob.txt
$ gprof orderbook_gprof gmon.out &gt; analysis.txt
$ cat analysis.txt
</code></pre></div></div>
<p>Examine the analysis.txt file which will break down the performance of the program as per the respective functions which
should help you get started.</p>
<p><em>Note: The performance with gprof can be a little more due to the overhead. We will be testing your program with the <br>
time command which should provide more accurate measures.</em></p>
<p><strong>Hints</strong></p>
<ul>
  <li>Think whether the issue is inside one particular function or the underlying data-structure.</li>
  <li>Theoretical time complexity ~ Computational time. Is there any particular type of data-structure well suited for this 
problem which can provide a near constant time complexity.</li>
  <li>What contributes to the system time.</li>
</ul>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="part---2-optional" class="title-text">Part - 2 (Optional)<a class="anchor title-text" href="#part---2-optional"> #</a>
</h2></div>
















<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>While time is an important factor while profiling, memory goes hand in hand with it. Once you have optimized for time, 
you need to now bring your heap memory equal to or less than our reference implementation. To measure memory use the 
following command:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ make orderbook_profile
$ env LD_PRELOAD=/lib/libmemusage.so ./orderbook_mem -i input/ascii_data.txt -o ob.txt
</code></pre></div></div>
<p>This should provide you with the following output regarding the amount of heap memory consumed:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Memory usage summary: heap total: 16948324, heap peak: 2519164, stack peak: 344
         total calls   total memory   failed calls
 malloc|     470778       16948324              0
realloc|          0              0              0  (nomove:0, dec:0, free:0)
 calloc|          0              0              0
   free|     548400       16948324
</code></pre></div></div>
<p><em>Note: orderbook_mem is compiled using -m32 flag which generates a 32 bit executable. This will thus generate consistent 
memory usage on both 32 bit and 64 bit systems.</em></p>
<p><strong>Task</strong></p>
<p>Our reference implementation uses <strong>11320000</strong> bytes of heap memory for ascii_data.txt dataset. For the <strong><em>-h</em></strong> flag which will 
execute your time optimized implementation, bring your memory consumption equal to or less than this value. We will be looking 
out for the stack segment as well and thus ensure that your stack peak is less than <strong>2500</strong> bytes.</p>
<p><strong>Hints</strong></p>
<ul>
  <li>Go over the data inside ascii_data.txt determining the highest values. We will not be crossing that threshold for our 
testing data-sets. Typically, in the real world scenario’s there is a predefined min / max however you will also come 
across instances when you have to come up with a comprehensive min-max values and store it appropriately.</li>
  <li>Think about the respective data-types that can effectively store the values without wasting memory.</li>
  <li>Take into consideration padding. Memory is stored and retrieved in the form of words size of which is 4 bytes for 
32-bit and 8 bytes for 64-bit. Thus, size of 29 byte struct will be padded to 32 bytes. <a href="https://stackoverflow.com/questions/4306186/structure-padding-and-packing" class="fancy-link wiki-link">Struct Padding &amp; Packing</a>
</li>
</ul>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="challenge-not-graded" class="title-text">Challenge (Not Graded)<a class="anchor title-text" href="#challenge-not-graded"> #</a>
</h2></div>









<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>Once you have optimized your program for both time and memory, your implementation is ready to face the real world challenge. 
We have a data file with 10 million order entries. Do you think your program can handle so many transactions?</p>
<p>Please click on the following link to download the data file (~225 MB): <a href="https://drive.google.com/file/d/1Km9UF0DLtsl4Zq3oYp5Af5EVg262JG3S/view?usp=sharing" class="fancy-link wiki-link">dat10m.txt</a></p>
<p>Our reference implementation which uses no tricks and no clever optimizations except for allocating more memory for our 
datastructure executes this with the following performance:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$  time ./orderbook -h -i input/dat10m.txt -o ob.txt
real    0m5.574s
user    0m5.127s
sys     0m0.095s
</code></pre></div></div>
<p>It is very well possible to get below <strong>~1.000s</strong> for processing this dataset. Up for a challenge!</p>
</div></div></div>
</div></div>
</div>
            
            <div class="wrapper">
<div class="pad"><div class="card">
<div class="title"><h2 id="submission-instructions" class="title-text">Submission Instructions<a class="anchor title-text" href="#submission-instructions"> #</a>
</h2></div>















<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>Please read details on <a href="/#academic-integrity" class="fancy-link wiki-link">Academic Integrity</a> fully. These are shared by all assignments in CS 341.</p>
<p>We will be using GitHub as our hand-in system this semester. Our grading system will checkout your most recent (pre-deadline) commit for grading. Therefore, to hand in your code, all you have to do is commit and push to your Github repository.</p>
<p>To check out the provided code for <code class="highlighter-rouge">assignments-pugnacious_profilers</code> from the class repository, go to your cs341 directory (the one you checked out for “know your tools”) and run:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git pull release master
</code></pre></div></div>
<p>If you run <code class="language-plaintext highlighter-rouge"><a href="https://man7.org/linux/man-pages/./man1/ls.1p.html" class="fancy-link">ls</a></code> you will now see a <code class="language-plaintext highlighter-rouge">assignments-pugnacious_profilers</code> folder, where you can find this assignment! To commit your changes (send them to us), type:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add assignments-pugnacious_profilers
git commit -m "assignments-pugnacious_profilers submission"
git push origin master
</code></pre></div></div>
<p>Your repository directory can be viewed from a web browser from the following URL: 
<a href="https://github-dev.cs.illinois.edu/cs341-sp25/NETID/tree/master/assignments-pugnacious_profilers" class="fancy-link wiki-link">https://github-dev.cs.illinois.edu/cs341-sp25/NETID/tree/master/assignments-pugnacious_profilers</a> where NETID is your University NetID. It is important to check that the files you expect to be graded are present and up to date in your remote git copy.</p>
</div></div></div>
</div></div>
<div class="pad"><div class="card">
<div class="title"><h2 id="assignment-feedback" class="title-text">Assignment Feedback<a class="anchor title-text" href="#assignment-feedback"> #</a>
</h2></div>







<div class="container-fluid"><div class="row"><div class="content col-sm-11 .col-sm-offset-1">
<p>We strive to provide the best assignments that we can for this course, and we would like your feedback on them!</p>
<p>This is the form we will use to evaluate our assignments. We appreciate the time you take to give us your honest feedback and we promise to keep improving the course to make your experience in CS 341 the best it can be.</p>
<p><a href="https://goo.gl/forms/hREf0ojFWumYfQF12" class="fancy-link wiki-link">https://goo.gl/forms/hREf0ojFWumYfQF12</a></p>
</div></div></div>
</div></div>
</div>
          </div>
          <div class="col-md-2 col-sm-1 col-xs-0"></div>
        </div>
        <!-- Mathjax takes a while to load so do a lazy load to so we can get accessibility -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous"></script>

<!-- Bring in JQuery and Bootstrap -->
<script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" crossorigin="anonymous"></script>
<!-- For table of content -->
<script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script>
<script src="/js/scroll.js"></script>
<footer class="">

<!-- Add another container at the bottom so there is some space there -->
<div class="container-fluid">
<div class="shadow"></div>

</div>

</footer>

      </div>
    </div>
  </div>
  <script type="application/javascript">
    var github_repo = "illinois-cs241/illinois-cs241.github.io";
    var github_path = "_docs/pugnacious_profilers.md";
  </script>
</body>

</html>